{"data":{"_id":"S1K0-21gS","title":"rt-thread内核笔记","date":"2019-06-25 22:39","update":"2019-06-25 22:39","series":"单片机","categories":["单片机"],"tags":["rt-thread","笔记"]},"__content":"<h2 id=\"7.%E4%B8%B4%E7%95%8C%E8%B5%84%E6%BA%90\" tabindex=\"-1\">7.临界资源</h2>\n<p><strong>临界资源</strong>:</p>\n<p>关闭系统调度</p>\n<pre><code class=\"language-c\">rt_enter_critical()     //关闭系统调度\n......\nrt_exit_critical()      //调度器解锁\n</code></pre>\n<p>关闭中断</p>\n<pre><code class=\"language-c\">level = rt_hw_inerrupt_disbale();\n......\nrt_exit_critical()      //调度器解锁\n</code></pre>\n<p>关闭中断</p>\n<pre><code class=\"language-c\">level = rt_hw_inerrupt_disbale();\n......\nrt_exit_critical()      //调度器解锁\n</code></pre>\n<p>关闭中断</p>\n<pre><code class=\"language-c\">level = rt_hw_inerrupt_disbale();\n......\nrt_hw_inerrupt_enbale();\n</code></pre>\n<p>互斥</p>\n<h3 id=\"%E4%B8%B4%E7%95%8C%E5%8C%BA%E4%BF%9D%E6%8A%A4%E7%A4%BA%E4%BE%8B\" tabindex=\"-1\">临界区保护示例</h3>\n<h2 id=\"8.%E4%BF%A1%E5%8F%B7%E9%87%8F%E7%9A%84%E4%BD%BF%E7%94%A8\" tabindex=\"-1\">8.信号量的使用</h2>\n<p>进/线程间的通信</p>\n<p>IPC</p>\n<ul>\n<li>同步</li>\n<li>互斥</li>\n<li>交换数据</li>\n</ul>\n<pre><code class=\"language-c\">struct rt_semaphore {\n    struct rt_ipc_object parent;\n    rt_uint16_t value;\n}\n</code></pre>\n<pre><code class=\"language-c\">rt_sem_t dynamic_sem    动态/指针\n</code></pre>\n<p>操作</p>\n<ul>\n<li>初始化/脱离</li>\n<li>创建/删除</li>\n<li>获取信号量</li>\n<li>释放信号量</li>\n</ul>\n<h2 id=\"%E7%94%9F%E4%BA%A7%E8%80%85%E6%B6%88%E8%B4%B9%E8%80%85%E9%97%AE%E9%A2%98\" tabindex=\"-1\">生产者消费者问题</h2>\n<p>示例代码:</p>\n<pre><code class=\"language-c\">rt_sem_init()\nrt_sem_init()\nrt_sem_init()\n</code></pre>\n<h2 id=\"%E4%BA%92%E6%96%A5%E9%87%8F%E7%9A%84%E4%BD%BF%E7%94%A8\" tabindex=\"-1\">互斥量的使用</h2>\n<p>IPC对象</p>\n<p>二值信号量</p>\n<pre><code class=\"language-c\">struct mutex {\n    rt_uint16_t value;\n    rt_uint8_t original_priority;\n    rt_uint8_t hold;\n    struct rt_thread *ower;\n}\n</code></pre>\n<ul>\n<li>初始化/脱离\n<ul>\n<li><code>rt_mutex_init</code></li>\n<li><code>rt_mutex_detach</code></li>\n</ul>\n</li>\n<li>创建/删除\n<ul>\n<li><code>rt_mutex_create</code></li>\n<li><code>rt_mutex_delate</code></li>\n</ul>\n</li>\n<li>获取\n<ul>\n<li><code>rt_mutex_take</code></li>\n</ul>\n</li>\n<li>释放\n<ul>\n<li><code>rt_mutex_release</code></li>\n</ul>\n</li>\n</ul>\n<p>示例:<code>mutex_sample.c</code></p>\n"}